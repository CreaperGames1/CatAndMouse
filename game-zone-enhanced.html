<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epic Game Zone üéÆ - Multiplayer Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Animated Stars Background */
        .stars, .stars2, .stars3 {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .stars {
            background: transparent url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAIAAAACCAYAAABytg0kAAAAEklEQVQIW2P4//8/AxYMRgYGADigBAz5p6RnAAAAAElFTkSuQmCC') repeat;
            animation: animateStars 50s linear infinite;
        }

        .stars2 {
            background: transparent url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQIW2P4//8/AwAI/AL+hc2rNAAAAABJRU5ErkJggg==') repeat;
            animation: animateStars 100s linear infinite;
            opacity: 0.5;
        }

        .stars3 {
            background: transparent url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAADCAYAAABWKLW/AAAAFUlEQVQIW2P4//8/AzbMgEUaXRoANmQEAp0LS0UAAAAASUVORK5CYII=') repeat;
            animation: animateStars 150s linear infinite;
            opacity: 0.3;
        }

        @keyframes animateStars {
            from { transform: translateY(0px); }
            to { transform: translateY(-2000px); }
        }

        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .login-screen.hidden {
            display: none;
        }

        .login-box {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            text-align: center;
            max-width: 400px;
            width: 90%;
            animation: slideIn 0.5s;
        }

        @keyframes slideIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .login-box h2 {
            font-size: 2.5rem;
            margin-bottom: 30px;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s;
        }

        .input-group input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255, 255, 255, 0.2);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            gap: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-group label {
            cursor: pointer;
            user-select: none;
        }

        .device-selection {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }

        .device-btn {
            flex: 1;
            padding: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.2rem;
        }

        .device-btn:hover {
            transform: scale(1.05);
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.3);
        }

        .device-btn.selected {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.5);
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }

        .login-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        /* Header */
        header {
            text-align: center;
            padding: 50px 20px 20px 20px;
            position: relative;
            z-index: 1;
        }

        .welcome-msg {
            font-size: 1.2rem;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .header-buttons {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .logout-btn, .friends-btn, .notifications-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .logout-btn:hover, .friends-btn:hover, .notifications-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .glitch {
            font-size: 4rem;
            font-weight: bold;
            text-shadow: 
                0 0 10px rgba(255, 255, 255, 0.8),
                0 0 20px rgba(102, 126, 234, 0.8),
                0 0 30px rgba(118, 75, 162, 0.8);
            animation: glitch 2s infinite;
        }

        @keyframes glitch {
            0%, 100% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
        }

        /* Friends Panel */
        .friends-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            padding: 20px;
            transition: right 0.3s;
            z-index: 9998;
            overflow-y: auto;
        }

        .friends-panel.open {
            right: 0;
        }

        .friends-panel h2 {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
        }

        .close-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
        }

        .add-friend-section {
            margin-bottom: 30px;
        }

        .add-friend-input {
            width: calc(100% - 80px);
            padding: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            margin-right: 10px;
        }

        .add-friend-btn {
            padding: 10px 20px;
            background: #667eea;
            border: none;
            border-radius: 5px;
            color: white;
            cursor: pointer;
        }

        .add-friend-btn:hover {
            background: #764ba2;
        }

        .friend-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .friend-tab {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
        }

        .friend-tab.active {
            background: #667eea;
            border-color: #667eea;
        }

        .friend-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .friend-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .friend-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .friend-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .friend-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #44ff44;
            position: absolute;
            bottom: 0;
            right: 0;
        }

        .friend-status.offline {
            background: #888;
        }

        .friend-actions {
            display: flex;
            gap: 5px;
        }

        .friend-action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .accept-btn {
            background: #44ff44;
            color: #000;
        }

        .decline-btn {
            background: #ff4444;
            color: white;
        }

        .challenge-btn {
            background: #667eea;
            color: white;
        }

        .remove-btn {
            background: #ff4444;
            color: white;
        }

        /* Notifications Panel */
        .notifications-panel {
            position: fixed;
            top: 70px;
            right: 20px;
            width: 350px;
            max-height: 500px;
            background: rgba(0, 0, 0, 0.95);
            border-radius: 10px;
            padding: 20px;
            display: none;
            z-index: 9999;
            overflow-y: auto;
        }

        .notifications-panel.open {
            display: block;
        }

        .notification-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .notification-item.challenge {
            border-left: 4px solid #667eea;
        }

        .notification-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        /* Challenge Modal */
        .challenge-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .challenge-modal.open {
            display: flex;
        }

        .challenge-content {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
        }

        .game-select {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .game-option {
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .game-option:hover {
            background: rgba(102, 126, 234, 0.3);
            border-color: #667eea;
            transform: scale(1.05);
        }

        /* Game Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .game-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .game-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .game-card h2 {
            font-size: 2rem;
            margin-bottom: 20px;
            text-align: center;
        }

        .game-info {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }

        .game-canvas-container {
            position: relative;
            margin: 20px 0;
        }

        canvas {
            width: 100%;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .game-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .game-btn {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 50px;
            color: white;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .game-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.5);
        }

        .mobile-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .mobile-btn {
            padding: 15px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mobile-btn:hover, .mobile-btn:active {
            background: rgba(255, 255, 255, 0.4);
            transform: scale(0.95);
        }

        .mobile-btn:nth-child(2) {
            grid-column: 2;
        }

        .mobile-btn:nth-child(1) {
            grid-column: 2;
            grid-row: 1;
        }

        .mobile-btn:nth-child(3) {
            grid-column: 1;
            grid-row: 2;
        }

        .mobile-btn:nth-child(4) {
            grid-column: 3;
            grid-row: 2;
        }

        .mobile-btn:nth-child(5) {
            grid-column: 2;
            grid-row: 2;
        }

        /* Multiplayer Status */
        .multiplayer-status {
            background: rgba(255, 255, 255, 0.1);
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
            text-align: center;
        }

        .vs-display {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin: 10px 0;
        }

        .player-info {
            text-align: center;
        }

        .player-score {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }

        @media (max-width: 768px) {
            .friends-panel {
                width: 100%;
                right: -100%;
            }

            .game-grid {
                grid-template-columns: 1fr;
            }

            .glitch {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="stars"></div>
    <div class="stars2"></div>
    <div class="stars3"></div>

    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <h2 class="glitch">üéÆ GAME ZONE</h2>
            <div class="input-group">
                <input type="text" id="usernameInput" placeholder="Enter your username" maxlength="20">
            </div>
            <div class="checkbox-group">
                <input type="checkbox" id="rememberMe">
                <label for="rememberMe">Remember me</label>
            </div>
            <div class="device-selection">
                <div class="device-btn selected" onclick="selectDevice('pc')">
                    üñ•Ô∏è<br>PC
                </div>
                <div class="device-btn" onclick="selectDevice('mobile')">
                    üì±<br>Mobile
                </div>
            </div>
            <button class="login-btn" onclick="login()">START GAMING</button>
        </div>
    </div>

    <!-- Friends Panel -->
    <div class="friends-panel" id="friendsPanel">
        <button class="close-panel" onclick="toggleFriendsPanel()">√ó</button>
        <h2>üë• Friends</h2>
        
        <div class="add-friend-section">
            <input type="text" class="add-friend-input" id="addFriendInput" placeholder="Enter username...">
            <button class="add-friend-btn" onclick="sendFriendRequest()">Add</button>
        </div>

        <div class="friend-tabs">
            <div class="friend-tab active" onclick="switchFriendTab('friends')">Friends</div>
            <div class="friend-tab" onclick="switchFriendTab('requests')">Requests <span id="requestCount"></span></div>
        </div>

        <div class="friend-list" id="friendsList"></div>
        <div class="friend-list" id="requestsList" style="display: none;"></div>
    </div>

    <!-- Notifications Panel -->
    <div class="notifications-panel" id="notificationsPanel">
        <h3>üîî Notifications</h3>
        <div id="notificationsList"></div>
    </div>

    <!-- Challenge Modal -->
    <div class="challenge-modal" id="challengeModal">
        <div class="challenge-content">
            <h2>Challenge <span id="challengeOpponent"></span></h2>
            <p>Choose a game:</p>
            <div class="game-select">
                <div class="game-option" onclick="startChallenge('snake')">
                    üêç Snake
                </div>
                <div class="game-option" onclick="startChallenge('pong')">
                    üèì Pong
                </div>
                <div class="game-option" onclick="startChallenge('tictactoe')">
                    ‚≠ï Tic-Tac-Toe
                </div>
                <div class="game-option" onclick="startChallenge('racing')">
                    üèéÔ∏è Racing
                </div>
            </div>
            <button class="game-btn" onclick="closeChallengeModal()">Cancel</button>
        </div>
    </div>

    <!-- Main Content -->
    <header>
        <div class="header-buttons">
            <button class="notifications-btn" onclick="toggleNotifications()">
                üîî
                <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
            </button>
            <button class="friends-btn" onclick="toggleFriendsPanel()">üë• Friends</button>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
        <div class="welcome-msg" id="welcomeMsg"></div>
        <h1 class="glitch">üéÆ EPIC GAME ZONE üéÆ</h1>
    </header>

    <div class="container">
        <div class="game-grid">
            <!-- Snake Game -->
            <div class="game-card">
                <h2>üêç Snake Game</h2>
                <div class="multiplayer-status" id="snakeMultiplayer" style="display: none;">
                    <div class="vs-display">
                        <div class="player-info">
                            <div id="snakePlayer1Name">You</div>
                            <div class="player-score" id="snakePlayer1Score">0</div>
                        </div>
                        <div>VS</div>
                        <div class="player-info">
                            <div id="snakePlayer2Name">Opponent</div>
                            <div class="player-score" id="snakePlayer2Score">0</div>
                        </div>
                    </div>
                </div>
                <div class="game-info">
                    <div>Score: <span id="snakeScore">0</span></div>
                    <div>High Score: <span id="snakeHighScore">0</span></div>
                </div>
                <div class="game-canvas-container">
                    <canvas id="snakeCanvas"></canvas>
                </div>
                <div class="game-controls">
                    <button class="game-btn" onclick="startSnake()">Start</button>
                    <button class="game-btn" onclick="restartSnake()">Restart</button>
                </div>
                <div class="mobile-controls" id="snakeMobileControls" style="display: none;">
                    <button class="mobile-btn" onclick="snakeMobileControl('up')">‚Üë</button>
                    <button class="mobile-btn" onclick="snakeMobileControl('left')">‚Üê</button>
                    <button class="mobile-btn" onclick="snakeMobileControl('down')">‚Üì</button>
                    <button class="mobile-btn" onclick="snakeMobileControl('right')">‚Üí</button>
                </div>
            </div>

            <!-- Pong Game -->
            <div class="game-card">
                <h2>üèì Pong</h2>
                <div class="multiplayer-status" id="pongMultiplayer" style="display: none;">
                    <div class="vs-display">
                        <div class="player-info">
                            <div id="pongPlayer1Name">You</div>
                            <div class="player-score" id="pongPlayer1Score">0</div>
                        </div>
                        <div>VS</div>
                        <div class="player-info">
                            <div id="pongPlayer2Name">AI</div>
                            <div class="player-score" id="pongPlayer2Score">0</div>
                        </div>
                    </div>
                </div>
                <div class="game-canvas-container">
                    <canvas id="pongCanvas"></canvas>
                </div>
                <div class="game-controls">
                    <button class="game-btn" onclick="startPong()">Start</button>
                    <button class="game-btn" onclick="restartPong()">Restart</button>
                </div>
                <div class="mobile-controls" id="pongMobileControls" style="display: none;">
                    <button class="mobile-btn" onclick="pongMobileControl('up')">‚Üë</button>
                    <button class="mobile-btn" onclick="pongMobileControl('down')">‚Üì</button>
                </div>
            </div>

            <!-- Tic-Tac-Toe -->
            <div class="game-card">
                <h2>‚≠ï Tic-Tac-Toe</h2>
                <div class="multiplayer-status" id="tttMultiplayer" style="display: none;">
                    <div class="vs-display">
                        <div class="player-info">
                            <div id="tttPlayer1Name">You (X)</div>
                        </div>
                        <div>VS</div>
                        <div class="player-info">
                            <div id="tttPlayer2Name">AI (O)</div>
                        </div>
                    </div>
                </div>
                <div class="game-canvas-container">
                    <canvas id="tttCanvas"></canvas>
                </div>
                <div class="game-controls">
                    <button class="game-btn" onclick="startTicTacToe()">Start</button>
                    <button class="game-btn" onclick="restartTicTacToe()">Restart</button>
                </div>
            </div>

            <!-- Racing Game -->
            <div class="game-card">
                <h2>üèéÔ∏è Racing</h2>
                <div class="multiplayer-status" id="racingMultiplayer" style="display: none;">
                    <div class="vs-display">
                        <div class="player-info">
                            <div id="racingPlayer1Name">You</div>
                            <div class="player-score" id="racingPlayer1Score">0</div>
                        </div>
                        <div>VS</div>
                        <div class="player-info">
                            <div id="racingPlayer2Name">Opponent</div>
                            <div class="player-score" id="racingPlayer2Score">0</div>
                        </div>
                    </div>
                </div>
                <div class="game-info">
                    <div>Speed: <span id="racingSpeed">0</span></div>
                    <div>Distance: <span id="racingDistance">0</span></div>
                </div>
                <div class="game-canvas-container">
                    <canvas id="racingCanvas"></canvas>
                </div>
                <div class="game-controls">
                    <button class="game-btn" onclick="startRacing()">Start</button>
                    <button class="game-btn" onclick="restartRacing()">Restart</button>
                </div>
                <div class="mobile-controls" id="racingMobileControls" style="display: none;">
                    <button class="mobile-btn" onclick="racingMobileControl('left')">‚Üê</button>
                    <button class="mobile-btn" onclick="racingMobileControl('right')">‚Üí</button>
                    <button class="mobile-btn" onclick="racingMobileControl('up')">‚Üë</button>
                </div>
            </div>

            <!-- Tetris Game -->
            <div class="game-card">
                <h2>üß± Tetris</h2>
                <div class="game-info">
                    <div>Score: <span id="tetrisScore">0</span></div>
                    <div>Level: <span id="tetrisLevel">1</span></div>
                </div>
                <div class="game-canvas-container">
                    <canvas id="tetrisCanvas"></canvas>
                </div>
                <div class="game-controls">
                    <button class="game-btn" onclick="startTetris()">Start</button>
                    <button class="game-btn" onclick="restartTetris()">Restart</button>
                </div>
                <div class="mobile-controls" id="tetrisMobileControls" style="display: none;">
                    <button class="mobile-btn" onclick="tetrisMobileControl('rotate')">‚Üª</button>
                    <button class="mobile-btn" onclick="tetrisMobileControl('left')">‚Üê</button>
                    <button class="mobile-btn" onclick="tetrisMobileControl('down')">‚Üì</button>
                    <button class="mobile-btn" onclick="tetrisMobileControl('right')">‚Üí</button>
                </div>
            </div>

            <!-- Pac-Man Game -->
            <div class="game-card">
                <h2>üëª Pac-Man</h2>
                <div class="game-info">
                    <div>Score: <span id="pacmanScore">0</span></div>
                    <div>Lives: <span id="pacmanLives">3</span></div>
                </div>
                <div class="game-canvas-container">
                    <canvas id="pacmanCanvas"></canvas>
                </div>
                <div class="game-controls">
                    <button class="game-btn" onclick="startPacman()">Start</button>
                    <button class="game-btn" onclick="restartPacman()">Restart</button>
                </div>
                <div class="mobile-controls" id="pacmanMobileControls" style="display: none;">
                    <button class="mobile-btn" onclick="pacmanMobileControl('up')">‚Üë</button>
                    <button class="mobile-btn" onclick="pacmanMobileControl('left')">‚Üê</button>
                    <button class="mobile-btn" onclick="pacmanMobileControl('down')">‚Üì</button>
                    <button class="mobile-btn" onclick="pacmanMobileControl('right')">‚Üí</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentUsername = '';
        let currentDevice = 'pc';
        let friends = [];
        let friendRequests = [];
        let notifications = [];
        let activeChallenge = null;

        // Initialize on page load
        window.onload = function() {
            checkRememberedUser();
        };

        // Device Selection
        function selectDevice(device) {
            currentDevice = device;
            document.querySelectorAll('.device-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.closest('.device-btn').classList.add('selected');

            // Show/hide mobile controls based on device
            const mobileControls = document.querySelectorAll('.mobile-controls');
            mobileControls.forEach(control => {
                control.style.display = device === 'mobile' ? 'grid' : 'none';
            });
        }

        // Check for remembered user
        function checkRememberedUser() {
            const remembered = localStorage.getItem('rememberedUser');
            if (remembered) {
                document.getElementById('usernameInput').value = remembered;
                document.getElementById('rememberMe').checked = true;
            }
        }

        // Login
        function login() {
            const username = document.getElementById('usernameInput').value.trim();
            if (!username) {
                alert('Please enter a username!');
                return;
            }

            currentUsername = username;

            if (document.getElementById('rememberMe').checked) {
                localStorage.setItem('rememberedUser', username);
            } else {
                localStorage.removeItem('rememberedUser');
            }

            // Load user data
            loadUserData();

            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('welcomeMsg').textContent = `Welcome back, ${username}! üéÆ`;
            
            // Show mobile controls if mobile device selected
            if (currentDevice === 'mobile') {
                document.querySelectorAll('.mobile-controls').forEach(control => {
                    control.style.display = 'grid';
                });
            }
        }

        // Logout
        function logout() {
            saveUserData();
            currentUsername = '';
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('usernameInput').value = '';
            location.reload();
        }

        // Load user data from localStorage
        function loadUserData() {
            const userData = localStorage.getItem(`gameZone_${currentUsername}`);
            if (userData) {
                const data = JSON.parse(userData);
                friends = data.friends || [];
                friendRequests = data.friendRequests || [];
                notifications = data.notifications || [];
                updateFriendsDisplay();
                updateNotifications();
            }
        }

        // Save user data to localStorage
        function saveUserData() {
            const userData = {
                friends: friends,
                friendRequests: friendRequests,
                notifications: notifications
            };
            localStorage.setItem(`gameZone_${currentUsername}`, JSON.stringify(userData));
        }

        // ========== FRIENDS SYSTEM ==========

        function toggleFriendsPanel() {
            const panel = document.getElementById('friendsPanel');
            panel.classList.toggle('open');
        }

        function switchFriendTab(tab) {
            document.querySelectorAll('.friend-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            if (tab === 'friends') {
                document.getElementById('friendsList').style.display = 'flex';
                document.getElementById('requestsList').style.display = 'none';
            } else {
                document.getElementById('friendsList').style.display = 'none';
                document.getElementById('requestsList').style.display = 'flex';
            }
        }

        function sendFriendRequest() {
            const username = document.getElementById('addFriendInput').value.trim();
            if (!username) {
                alert('Please enter a username!');
                return;
            }

            if (username === currentUsername) {
                alert("You can't add yourself!");
                return;
            }

            if (friends.find(f => f.username === username)) {
                alert('Already friends!');
                return;
            }

            if (friendRequests.find(r => r.from === username)) {
                alert('Request already exists!');
                return;
            }

            // Simulate sending request
            addNotification(`Friend request sent to ${username}`, 'info');
            document.getElementById('addFriendInput').value = '';

            // For demo: auto-create incoming request after 2 seconds
            setTimeout(() => {
                receiveFriendRequest(username);
            }, 2000);
        }

        function receiveFriendRequest(username) {
            friendRequests.push({
                from: username,
                timestamp: Date.now()
            });
            updateFriendsDisplay();
            addNotification(`${username} sent you a friend request!`, 'request');
            saveUserData();
        }

        function acceptFriendRequest(username) {
            friends.push({
                username: username,
                online: Math.random() > 0.5,
                addedAt: Date.now()
            });
            friendRequests = friendRequests.filter(r => r.from !== username);
            updateFriendsDisplay();
            addNotification(`You are now friends with ${username}!`, 'success');
            saveUserData();
        }

        function declineFriendRequest(username) {
            friendRequests = friendRequests.filter(r => r.from !== username);
            updateFriendsDisplay();
            saveUserData();
        }

        function removeFriend(username) {
            if (confirm(`Remove ${username} from friends?`)) {
                friends = friends.filter(f => f.username !== username);
                updateFriendsDisplay();
                saveUserData();
            }
        }

        function updateFriendsDisplay() {
            // Update friends list
            const friendsList = document.getElementById('friendsList');
            friendsList.innerHTML = '';
            
            if (friends.length === 0) {
                friendsList.innerHTML = '<p style="text-align: center; opacity: 0.6;">No friends yet. Add some!</p>';
            } else {
                friends.forEach(friend => {
                    const item = document.createElement('div');
                    item.className = 'friend-item';
                    item.innerHTML = `
                        <div class="friend-info">
                            <div style="position: relative;">
                                <div class="friend-avatar">${friend.username[0].toUpperCase()}</div>
                                <div class="friend-status ${friend.online ? '' : 'offline'}"></div>
                            </div>
                            <div>
                                <div style="font-weight: bold;">${friend.username}</div>
                                <div style="font-size: 0.8rem; opacity: 0.7;">${friend.online ? 'Online' : 'Offline'}</div>
                            </div>
                        </div>
                        <div class="friend-actions">
                            <button class="friend-action-btn challenge-btn" onclick="openChallengeModal('${friend.username}')">Challenge</button>
                            <button class="friend-action-btn remove-btn" onclick="removeFriend('${friend.username}')">Remove</button>
                        </div>
                    `;
                    friendsList.appendChild(item);
                });
            }

            // Update requests list
            const requestsList = document.getElementById('requestsList');
            requestsList.innerHTML = '';
            
            if (friendRequests.length === 0) {
                requestsList.innerHTML = '<p style="text-align: center; opacity: 0.6;">No pending requests</p>';
            } else {
                friendRequests.forEach(request => {
                    const item = document.createElement('div');
                    item.className = 'friend-item';
                    item.innerHTML = `
                        <div class="friend-info">
                            <div class="friend-avatar">${request.from[0].toUpperCase()}</div>
                            <div>
                                <div style="font-weight: bold;">${request.from}</div>
                                <div style="font-size: 0.8rem; opacity: 0.7;">Wants to be friends</div>
                            </div>
                        </div>
                        <div class="friend-actions">
                            <button class="friend-action-btn accept-btn" onclick="acceptFriendRequest('${request.from}')">Accept</button>
                            <button class="friend-action-btn decline-btn" onclick="declineFriendRequest('${request.from}')">Decline</button>
                        </div>
                    `;
                    requestsList.appendChild(item);
                });
            }

            // Update request count
            const countSpan = document.getElementById('requestCount');
            if (friendRequests.length > 0) {
                countSpan.textContent = `(${friendRequests.length})`;
            } else {
                countSpan.textContent = '';
            }
        }

        // ========== NOTIFICATIONS SYSTEM ==========

        function toggleNotifications() {
            const panel = document.getElementById('notificationsPanel');
            panel.classList.toggle('open');
        }

        function addNotification(message, type) {
            notifications.unshift({
                message: message,
                type: type,
                timestamp: Date.now()
            });
            
            // Keep only last 10 notifications
            if (notifications.length > 10) {
                notifications = notifications.slice(0, 10);
            }
            
            updateNotifications();
            saveUserData();
        }

        function updateNotifications() {
            const notificationsList = document.getElementById('notificationsList');
            const badge = document.getElementById('notificationBadge');
            
            if (notifications.length === 0) {
                notificationsList.innerHTML = '<p style="text-align: center; opacity: 0.6;">No notifications</p>';
                badge.style.display = 'none';
            } else {
                notificationsList.innerHTML = '';
                notifications.forEach(notif => {
                    const item = document.createElement('div');
                    item.className = `notification-item ${notif.type}`;
                    const time = new Date(notif.timestamp).toLocaleTimeString();
                    item.innerHTML = `
                        <div>${notif.message}</div>
                        <div style="font-size: 0.8rem; opacity: 0.6; margin-top: 5px;">${time}</div>
                    `;
                    notificationsList.appendChild(item);
                });
                badge.textContent = notifications.length;
                badge.style.display = 'flex';
            }
        }

        // ========== CHALLENGE SYSTEM ==========

        function openChallengeModal(username) {
            document.getElementById('challengeOpponent').textContent = username;
            document.getElementById('challengeModal').classList.add('open');
            activeChallenge = { opponent: username, game: null };
        }

        function closeChallengeModal() {
            document.getElementById('challengeModal').classList.remove('open');
            activeChallenge = null;
        }

        function startChallenge(game) {
            if (activeChallenge) {
                activeChallenge.game = game;
                addNotification(`Challenge sent to ${activeChallenge.opponent} for ${game}!`, 'challenge');
                closeChallengeModal();
                
                // Simulate opponent accepting after 3 seconds
                setTimeout(() => {
                    startMultiplayerGame(game, activeChallenge.opponent);
                }, 3000);
            }
        }

        function startMultiplayerGame(game, opponent) {
            addNotification(`${opponent} accepted your ${game} challenge!`, 'success');
            
            // Show multiplayer status for the game
            const multiplayerDiv = document.getElementById(`${game}Multiplayer`);
            if (multiplayerDiv) {
                multiplayerDiv.style.display = 'block';
                const player2Name = document.getElementById(`${game}Player2Name`);
                if (player2Name) {
                    player2Name.textContent = opponent;
                }
            }
            
            // Start the respective game
            switch(game) {
                case 'snake':
                    startSnake();
                    break;
                case 'pong':
                    startPong();
                    document.getElementById('pongPlayer2Name').textContent = opponent;
                    break;
                case 'tictactoe':
                    startTicTacToe();
                    document.getElementById('tttPlayer2Name').textContent = `${opponent} (O)`;
                    break;
                case 'racing':
                    startRacing();
                    break;
            }
        }

        // ========== SNAKE GAME ==========
        let snakeCanvas, snakeCtx, snake, food, snakeDirection, snakeScore, snakeGameRunning;

        function snakeMobileControl(direction) {
            snakeDirection = direction;
        }

        function startSnake() {
            snakeCanvas = document.getElementById('snakeCanvas');
            snakeCanvas.width = Math.min(400, window.innerWidth - 40);
            snakeCanvas.height = Math.min(400, window.innerWidth - 40);
            snakeCtx = snakeCanvas.getContext('2d');
            
            const gridSize = 20;
            snake = [{ x: 200, y: 200 }];
            food = { x: Math.floor(Math.random() * (snakeCanvas.width / gridSize)) * gridSize, 
                     y: Math.floor(Math.random() * (snakeCanvas.height / gridSize)) * gridSize };
            snakeDirection = 'right';
            snakeScore = 0;
            snakeGameRunning = true;
            
            document.getElementById('snakeScore').textContent = snakeScore;
            
            document.addEventListener('keydown', changeSnakeDirection);
            snakeGameLoop();
        }

        function changeSnakeDirection(e) {
            const LEFT = 37, UP = 38, RIGHT = 39, DOWN = 40;
            const A = 65, W = 87, D = 68, S = 83;
            
            if ((e.keyCode === LEFT || e.keyCode === A) && snakeDirection !== 'right') {
                snakeDirection = 'left';
            } else if ((e.keyCode === UP || e.keyCode === W) && snakeDirection !== 'down') {
                snakeDirection = 'up';
            } else if ((e.keyCode === RIGHT || e.keyCode === D) && snakeDirection !== 'left') {
                snakeDirection = 'right';
            } else if ((e.keyCode === DOWN || e.keyCode === S) && snakeDirection !== 'up') {
                snakeDirection = 'down';
            }
        }

        function snakeGameLoop() {
            if (!snakeGameRunning) return;
            
            setTimeout(() => {
                const gridSize = 20;
                const head = { ...snake[0] };
                
                if (snakeDirection === 'left') head.x -= gridSize;
                if (snakeDirection === 'right') head.x += gridSize;
                if (snakeDirection === 'up') head.y -= gridSize;
                if (snakeDirection === 'down') head.y += gridSize;
                
                // Check collision with walls
                if (head.x < 0 || head.x >= snakeCanvas.width || head.y < 0 || head.y >= snakeCanvas.height) {
                    gameOver('snake');
                    return;
                }
                
                // Check collision with self
                for (let segment of snake) {
                    if (head.x === segment.x && head.y === segment.y) {
                        gameOver('snake');
                        return;
                    }
                }
                
                snake.unshift(head);
                
                // Check if food is eaten
                if (head.x === food.x && head.y === food.y) {
                    snakeScore += 10;
                    document.getElementById('snakeScore').textContent = snakeScore;
                    
                    // Update high score
                    const highScore = localStorage.getItem('snakeHighScore') || 0;
                    if (snakeScore > highScore) {
                        localStorage.setItem('snakeHighScore', snakeScore);
                        document.getElementById('snakeHighScore').textContent = snakeScore;
                    }
                    
                    // Generate new food
                    food = { 
                        x: Math.floor(Math.random() * (snakeCanvas.width / gridSize)) * gridSize,
                        y: Math.floor(Math.random() * (snakeCanvas.height / gridSize)) * gridSize
                    };
                } else {
                    snake.pop();
                }
                
                // Draw
                snakeCtx.fillStyle = '#000';
                snakeCtx.fillRect(0, 0, snakeCanvas.width, snakeCanvas.height);
                
                // Draw snake
                snakeCtx.fillStyle = '#44ff44';
                snake.forEach((segment, index) => {
                    snakeCtx.fillRect(segment.x, segment.y, gridSize - 2, gridSize - 2);
                    if (index === 0) {
                        snakeCtx.fillStyle = '#00ff00';
                        snakeCtx.fillRect(segment.x, segment.y, gridSize - 2, gridSize - 2);
                        snakeCtx.fillStyle = '#44ff44';
                    }
                });
                
                // Draw food
                snakeCtx.fillStyle = '#ff4444';
                snakeCtx.fillRect(food.x, food.y, gridSize - 2, gridSize - 2);
                
                snakeGameLoop();
            }, 100);
        }

        function restartSnake() {
            startSnake();
        }

        // Load high score on page load
        document.addEventListener('DOMContentLoaded', () => {
            const highScore = localStorage.getItem('snakeHighScore') || 0;
            document.getElementById('snakeHighScore').textContent = highScore;
        });

        // ========== PONG GAME ==========
        let pongCanvas, pongCtx, paddle1, paddle2, ball, pongScore1, pongScore2, pongGameRunning;

        function pongMobileControl(direction) {
            if (direction === 'up' && paddle1.y > 0) paddle1.y -= 30;
            if (direction === 'down' && paddle1.y < pongCanvas.height - paddle1.height) paddle1.y += 30;
        }

        function startPong() {
            pongCanvas = document.getElementById('pongCanvas');
            pongCanvas.width = Math.min(600, window.innerWidth - 40);
            pongCanvas.height = Math.min(400, window.innerWidth - 40);
            pongCtx = pongCanvas.getContext('2d');
            
            paddle1 = { x: 10, y: pongCanvas.height / 2 - 50, width: 10, height: 100, dy: 0 };
            paddle2 = { x: pongCanvas.width - 20, y: pongCanvas.height / 2 - 50, width: 10, height: 100, dy: 4 };
            ball = { x: pongCanvas.width / 2, y: pongCanvas.height / 2, radius: 8, dx: 4, dy: 4 };
            pongScore1 = 0;
            pongScore2 = 0;
            pongGameRunning = true;
            
            document.getElementById('pongPlayer1Score').textContent = pongScore1;
            document.getElementById('pongPlayer2Score').textContent = pongScore2;
            document.getElementById('pongMultiplayer').style.display = 'block';
            
            document.addEventListener('keydown', movePaddle);
            document.addEventListener('keyup', stopPaddle);
            pongGameLoop();
        }

        function movePaddle(e) {
            if (e.keyCode === 38 || e.keyCode === 87) paddle1.dy = -6;
            if (e.keyCode === 40 || e.keyCode === 83) paddle1.dy = 6;
        }

        function stopPaddle(e) {
            if (e.keyCode === 38 || e.keyCode === 40 || e.keyCode === 87 || e.keyCode === 83) {
                paddle1.dy = 0;
            }
        }

        function pongGameLoop() {
            if (!pongGameRunning) return;
            
            setTimeout(() => {
                // Move paddle 1
                paddle1.y += paddle1.dy;
                if (paddle1.y < 0) paddle1.y = 0;
                if (paddle1.y > pongCanvas.height - paddle1.height) paddle1.y = pongCanvas.height - paddle1.height;
                
                // AI for paddle 2
                if (ball.y < paddle2.y + paddle2.height / 2) paddle2.y -= paddle2.dy;
                if (ball.y > paddle2.y + paddle2.height / 2) paddle2.y += paddle2.dy;
                
                // Move ball
                ball.x += ball.dx;
                ball.y += ball.dy;
                
                // Ball collision with top and bottom
                if (ball.y - ball.radius < 0 || ball.y + ball.radius > pongCanvas.height) {
                    ball.dy = -ball.dy;
                }
                
                // Ball collision with paddles
                if (ball.x - ball.radius < paddle1.x + paddle1.width && 
                    ball.y > paddle1.y && ball.y < paddle1.y + paddle1.height) {
                    ball.dx = -ball.dx;
                    ball.x = paddle1.x + paddle1.width + ball.radius;
                }
                
                if (ball.x + ball.radius > paddle2.x && 
                    ball.y > paddle2.y && ball.y < paddle2.y + paddle2.height) {
                    ball.dx = -ball.dx;
                    ball.x = paddle2.x - ball.radius;
                }
                
                // Score
                if (ball.x - ball.radius < 0) {
                    pongScore2++;
                    document.getElementById('pongPlayer2Score').textContent = pongScore2;
                    resetBall();
                }
                if (ball.x + ball.radius > pongCanvas.width) {
                    pongScore1++;
                    document.getElementById('pongPlayer1Score').textContent = pongScore1;
                    resetBall();
                }
                
                // Draw
                pongCtx.fillStyle = '#000';
                pongCtx.fillRect(0, 0, pongCanvas.width, pongCanvas.height);
                
                // Draw center line
                pongCtx.strokeStyle = '#fff';
                pongCtx.setLineDash([10, 10]);
                pongCtx.beginPath();
                pongCtx.moveTo(pongCanvas.width / 2, 0);
                pongCtx.lineTo(pongCanvas.width / 2, pongCanvas.height);
                pongCtx.stroke();
                pongCtx.setLineDash([]);
                
                // Draw paddles
                pongCtx.fillStyle = '#fff';
                pongCtx.fillRect(paddle1.x, paddle1.y, paddle1.width, paddle1.height);
                pongCtx.fillRect(paddle2.x, paddle2.y, paddle2.width, paddle2.height);
                
                // Draw ball
                pongCtx.beginPath();
                pongCtx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
                pongCtx.fill();
                
                pongGameLoop();
            }, 16);
        }

        function resetBall() {
            ball.x = pongCanvas.width / 2;
            ball.y = pongCanvas.height / 2;
            ball.dx = -ball.dx;
        }

        function restartPong() {
            startPong();
        }

        // ========== TIC-TAC-TOE GAME ==========
        let tttCanvas, tttCtx, tttBoard, tttCurrentPlayer, tttGameRunning;

        function startTicTacToe() {
            tttCanvas = document.getElementById('tttCanvas');
            tttCanvas.width = Math.min(400, window.innerWidth - 40);
            tttCanvas.height = Math.min(400, window.innerWidth - 40);
            tttCtx = tttCanvas.getContext('2d');
            
            tttBoard = Array(9).fill(null);
            tttCurrentPlayer = 'X';
            tttGameRunning = true;
            
            document.getElementById('tttMultiplayer').style.display = 'block';
            
            tttCanvas.addEventListener('click', handleTicTacToeClick);
            drawTicTacToe();
        }

        function handleTicTacToeClick(e) {
            if (!tttGameRunning) return;
            
            const rect = tttCanvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            const cellSize = tttCanvas.width / 3;
            const col = Math.floor(x / cellSize);
            const row = Math.floor(y / cellSize);
            const index = row * 3 + col;
            
            if (tttBoard[index] === null && tttCurrentPlayer === 'X') {
                tttBoard[index] = 'X';
                drawTicTacToe();
                
                if (checkWinner()) {
                    setTimeout(() => {
                        alert('You win!');
                        tttGameRunning = false;
                    }, 100);
                    return;
                }
                
                if (tttBoard.every(cell => cell !== null)) {
                    setTimeout(() => {
                        alert("It's a draw!");
                        tttGameRunning = false;
                    }, 100);
                    return;
                }
                
                tttCurrentPlayer = 'O';
                
                // AI move
                setTimeout(() => {
                    makeAIMove();
                }, 500);
            }
        }

        function makeAIMove() {
            const emptyCells = tttBoard.map((cell, i) => cell === null ? i : null).filter(i => i !== null);
            if (emptyCells.length > 0) {
                const randomIndex = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                tttBoard[randomIndex] = 'O';
                drawTicTacToe();
                
                if (checkWinner()) {
                    setTimeout(() => {
                        alert('AI wins!');
                        tttGameRunning = false;
                    }, 100);
                    return;
                }
                
                if (tttBoard.every(cell => cell !== null)) {
                    setTimeout(() => {
                        alert("It's a draw!");
                        tttGameRunning = false;
                    }, 100);
                    return;
                }
                
                tttCurrentPlayer = 'X';
            }
        }

        function checkWinner() {
            const winPatterns = [
                [0, 1, 2], [3, 4, 5], [6, 7, 8], // Rows
                [0, 3, 6], [1, 4, 7], [2, 5, 8], // Columns
                [0, 4, 8], [2, 4, 6] // Diagonals
            ];
            
            return winPatterns.some(pattern => {
                const [a, b, c] = pattern;
                return tttBoard[a] && tttBoard[a] === tttBoard[b] && tttBoard[a] === tttBoard[c];
            });
        }

        function drawTicTacToe() {
            const cellSize = tttCanvas.width / 3;
            
            // Clear canvas
            tttCtx.fillStyle = '#000';
            tttCtx.fillRect(0, 0, tttCanvas.width, tttCanvas.height);
            
            // Draw grid
            tttCtx.strokeStyle = '#fff';
            tttCtx.lineWidth = 3;
            for (let i = 1; i < 3; i++) {
                tttCtx.beginPath();
                tttCtx.moveTo(i * cellSize, 0);
                tttCtx.lineTo(i * cellSize, tttCanvas.height);
                tttCtx.stroke();
                
                tttCtx.beginPath();
                tttCtx.moveTo(0, i * cellSize);
                tttCtx.lineTo(tttCanvas.width, i * cellSize);
                tttCtx.stroke();
            }
            
            // Draw X's and O's
            tttBoard.forEach((cell, index) => {
                if (cell) {
                    const row = Math.floor(index / 3);
                    const col = index % 3;
                    const x = col * cellSize + cellSize / 2;
                    const y = row * cellSize + cellSize / 2;
                    
                    if (cell === 'X') {
                        tttCtx.strokeStyle = '#44ff44';
                        tttCtx.lineWidth = 5;
                        const offset = cellSize / 4;
                        tttCtx.beginPath();
                        tttCtx.moveTo(x - offset, y - offset);
                        tttCtx.lineTo(x + offset, y + offset);
                        tttCtx.stroke();
                        tttCtx.beginPath();
                        tttCtx.moveTo(x + offset, y - offset);
                        tttCtx.lineTo(x - offset, y + offset);
                        tttCtx.stroke();
                    } else {
                        tttCtx.strokeStyle = '#ff4444';
                        tttCtx.lineWidth = 5;
                        tttCtx.beginPath();
                        tttCtx.arc(x, y, cellSize / 3, 0, Math.PI * 2);
                        tttCtx.stroke();
                    }
                }
            });
        }

        function restartTicTacToe() {
            startTicTacToe();
        }

        // ========== RACING GAME ==========
        let racingCanvas, racingCtx, car, obstacles, racingSpeed, racingDistance, racingGameRunning;

        function racingMobileControl(direction) {
            if (direction === 'left' && car.x > 0) car.x -= 20;
            if (direction === 'right' && car.x < racingCanvas.width - car.width) car.x += 20;
            if (direction === 'up' && racingSpeed < 10) racingSpeed += 0.5;
        }

        function startRacing() {
            racingCanvas = document.getElementById('racingCanvas');
            racingCanvas.width = Math.min(400, window.innerWidth - 40);
            racingCanvas.height = Math.min(600, window.innerWidth - 40);
            racingCtx = racingCanvas.getContext('2d');
            
            car = { x: racingCanvas.width / 2 - 20, y: racingCanvas.height - 100, width: 40, height: 60 };
            obstacles = [];
            racingSpeed = 3;
            racingDistance = 0;
            racingGameRunning = true;
            
            document.getElementById('racingSpeed').textContent = racingSpeed.toFixed(1);
            document.getElementById('racingDistance').textContent = racingDistance;
            
            document.addEventListener('keydown', controlRacing);
            racingGameLoop();
        }

        function controlRacing(e) {
            const LEFT = 37, RIGHT = 39, UP = 38;
            const A = 65, D = 68, W = 87;
            
            if ((e.keyCode === LEFT || e.keyCode === A) && car.x > 0) {
                car.x -= 20;
            }
            if ((e.keyCode === RIGHT || e.keyCode === D) && car.x < racingCanvas.width - car.width) {
                car.x += 20;
            }
            if ((e.keyCode === UP || e.keyCode === W) && racingSpeed < 10) {
                racingSpeed += 0.5;
            }
        }

        function racingGameLoop() {
            if (!racingGameRunning) return;
            
            setTimeout(() => {
                // Add new obstacles
                if (Math.random() < 0.02) {
                    obstacles.push({
                        x: Math.random() * (racingCanvas.width - 40),
                        y: -60,
                        width: 40,
                        height: 60
                    });
                }
                
                // Move obstacles
                obstacles.forEach(obs => {
                    obs.y += racingSpeed;
                });
                
                // Remove off-screen obstacles
                obstacles = obstacles.filter(obs => obs.y < racingCanvas.height);
                
                // Check collisions
                for (let obs of obstacles) {
                    if (car.x < obs.x + obs.width &&
                        car.x + car.width > obs.x &&
                        car.y < obs.y + obs.height &&
                        car.y + car.height > obs.y) {
                        gameOver('racing');
                        return;
                    }
                }
                
                racingDistance += racingSpeed / 10;
                document.getElementById('racingDistance').textContent = Math.floor(racingDistance);
                document.getElementById('racingSpeed').textContent = racingSpeed.toFixed(1);
                
                // Draw
                racingCtx.fillStyle = '#333';
                racingCtx.fillRect(0, 0, racingCanvas.width, racingCanvas.height);
                
                // Draw road lines
                racingCtx.strokeStyle = '#fff';
                racingCtx.lineWidth = 3;
                racingCtx.setLineDash([20, 20]);
                racingCtx.beginPath();
                racingCtx.moveTo(racingCanvas.width / 2, 0);
                racingCtx.lineTo(racingCanvas.width / 2, racingCanvas.height);
                racingCtx.stroke();
                racingCtx.setLineDash([]);
                
                // Draw car
                racingCtx.fillStyle = '#44ff44';
                racingCtx.fillRect(car.x, car.y, car.width, car.height);
                racingCtx.fillStyle = '#000';
                racingCtx.fillRect(car.x + 5, car.y + 10, 10, 15);
                racingCtx.fillRect(car.x + 25, car.y + 10, 10, 15);
                
                // Draw obstacles
                racingCtx.fillStyle = '#ff4444';
                obstacles.forEach(obs => {
                    racingCtx.fillRect(obs.x, obs.y, obs.width, obs.height);
                });
                
                racingGameLoop();
            }, 30);
        }

        function restartRacing() {
            startRacing();
        }

        // ========== TETRIS GAME ==========
        let tetrisCanvas, tetrisCtx, tetrisBoard, currentPiece, tetrisScore, tetrisLevel, tetrisGameRunning;

        function tetrisMobileControl(direction) {
            if (direction === 'left' && canMovePiece(-1, 0)) currentPiece.x--;
            if (direction === 'right' && canMovePiece(1, 0)) currentPiece.x++;
            if (direction === 'down') dropTetrisPiece();
            if (direction === 'rotate') rotatePiece();
        }

        const tetrisPieces = [
            { shape: [[1,1,1,1]], color: '#00ffff' }, // I
            { shape: [[1,1],[1,1]], color: '#ffff00' }, // O
            { shape: [[0,1,0],[1,1,1]], color: '#ff00ff' }, // T
            { shape: [[1,1,0],[0,1,1]], color: '#00ff00' }, // S
            { shape: [[0,1,1],[1,1,0]], color: '#ff0000' }, // Z
            { shape: [[1,0,0],[1,1,1]], color: '#0000ff' }, // J
            { shape: [[0,0,1],[1,1,1]], color: '#ff8800' }  // L
        ];

        function startTetris() {
            tetrisCanvas = document.getElementById('tetrisCanvas');
            tetrisCanvas.width = 300;
            tetrisCanvas.height = 600;
            tetrisCtx = tetrisCanvas.getContext('2d');
            
            tetrisBoard = Array(20).fill().map(() => Array(10).fill(0));
            tetrisScore = 0;
            tetrisLevel = 1;
            tetrisGameRunning = true;
            
            document.getElementById('tetrisScore').textContent = tetrisScore;
            document.getElementById('tetrisLevel').textContent = tetrisLevel;
            
            spawnPiece();
            document.addEventListener('keydown', controlTetris);
            tetrisGameLoop();
        }

        function spawnPiece() {
            const piece = tetrisPieces[Math.floor(Math.random() * tetrisPieces.length)];
            currentPiece = {
                shape: piece.shape.map(row => [...row]),
                color: piece.color,
                x: 3,
                y: 0
            };
            
            if (!canMovePiece(0, 0)) {
                gameOver('tetris');
            }
        }

        function canMovePiece(dx, dy) {
            for (let r = 0; r < currentPiece.shape.length; r++) {
                for (let c = 0; c < currentPiece.shape[r].length; c++) {
                    if (currentPiece.shape[r][c]) {
                        const newX = currentPiece.x + c + dx;
                        const newY = currentPiece.y + r + dy;
                        
                        if (newX < 0 || newX >= 10 || newY >= 20) return false;
                        if (newY >= 0 && tetrisBoard[newY][newX]) return false;
                    }
                }
            }
            return true;
        }

        function rotatePiece() {
            const rotated = currentPiece.shape[0].map((_, i) =>
                currentPiece.shape.map(row => row[i]).reverse()
            );
            const oldShape = currentPiece.shape;
            currentPiece.shape = rotated;
            if (!canMovePiece(0, 0)) {
                currentPiece.shape = oldShape;
            }
        }

        function dropTetrisPiece() {
            if (canMovePiece(0, 1)) {
                currentPiece.y++;
            } else {
                // Lock piece
                for (let r = 0; r < currentPiece.shape.length; r++) {
                    for (let c = 0; c < currentPiece.shape[r].length; c++) {
                        if (currentPiece.shape[r][c]) {
                            tetrisBoard[currentPiece.y + r][currentPiece.x + c] = currentPiece.color;
                        }
                    }
                }
                
                // Clear lines
                let linesCleared = 0;
                for (let r = 19; r >= 0; r--) {
                    if (tetrisBoard[r].every(cell => cell !== 0)) {
                        tetrisBoard.splice(r, 1);
                        tetrisBoard.unshift(Array(10).fill(0));
                        linesCleared++;
                        r++;
                    }
                }
                
                if (linesCleared > 0) {
                    tetrisScore += linesCleared * 100 * tetrisLevel;
                    document.getElementById('tetrisScore').textContent = tetrisScore;
                    tetrisLevel = Math.floor(tetrisScore / 1000) + 1;
                    document.getElementById('tetrisLevel').textContent = tetrisLevel;
                }
                
                spawnPiece();
            }
        }

        function controlTetris(e) {
            if (!tetrisGameRunning) return;
            
            const LEFT = 37, RIGHT = 39, DOWN = 40, UP = 38;
            const A = 65, D = 68, S = 83, W = 87;
            
            if ((e.keyCode === LEFT || e.keyCode === A) && canMovePiece(-1, 0)) {
                currentPiece.x--;
            }
            if ((e.keyCode === RIGHT || e.keyCode === D) && canMovePiece(1, 0)) {
                currentPiece.x++;
            }
            if ((e.keyCode === DOWN || e.keyCode === S)) {
                dropTetrisPiece();
            }
            if (e.keyCode === UP || e.keyCode === W) {
                rotatePiece();
            }
        }

        function tetrisGameLoop() {
            if (!tetrisGameRunning) return;
            
            setTimeout(() => {
                const cellSize = 30;
                
                // Clear canvas
                tetrisCtx.fillStyle = '#000';
                tetrisCtx.fillRect(0, 0, tetrisCanvas.width, tetrisCanvas.height);
                
                // Draw board
                for (let r = 0; r < 20; r++) {
                    for (let c = 0; c < 10; c++) {
                        if (tetrisBoard[r][c]) {
                            tetrisCtx.fillStyle = tetrisBoard[r][c];
                            tetrisCtx.fillRect(c * cellSize, r * cellSize, cellSize - 1, cellSize - 1);
                        }
                    }
                }
                
                // Draw current piece
                for (let r = 0; r < currentPiece.shape.length; r++) {
                    for (let c = 0; c < currentPiece.shape[r].length; c++) {
                        if (currentPiece.shape[r][c]) {
                            tetrisCtx.fillStyle = currentPiece.color;
                            tetrisCtx.fillRect(
                                (currentPiece.x + c) * cellSize,
                                (currentPiece.y + r) * cellSize,
                                cellSize - 1,
                                cellSize - 1
                            );
                        }
                    }
                }
                
                // Draw grid
                tetrisCtx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                for (let r = 0; r <= 20; r++) {
                    tetrisCtx.beginPath();
                    tetrisCtx.moveTo(0, r * cellSize);
                    tetrisCtx.lineTo(300, r * cellSize);
                    tetrisCtx.stroke();
                }
                for (let c = 0; c <= 10; c++) {
                    tetrisCtx.beginPath();
                    tetrisCtx.moveTo(c * cellSize, 0);
                    tetrisCtx.lineTo(c * cellSize, 600);
                    tetrisCtx.stroke();
                }
                
                dropTetrisPiece();
                tetrisGameLoop();
            }, Math.max(500 - tetrisLevel * 50, 100));
        }

        function restartTetris() {
            startTetris();
        }

        // ========== PAC-MAN GAME ==========
        let pacmanCanvas, pacmanCtx, pacman, ghosts, dots, pacmanScore, pacmanLives, pacmanGameRunning;

        function pacmanMobileControl(direction) {
            const event = { 
                keyCode: direction === 'up' ? 38 : direction === 'down' ? 40 : 
                         direction === 'left' ? 37 : 39 
            };
            changePacmanDirection(event);
        }

        function startPacman() {
            pacmanCanvas = document.getElementById('pacmanCanvas');
            pacmanCanvas.width = Math.min(500, window.innerWidth - 40);
            pacmanCanvas.height = Math.min(500, window.innerWidth - 40);
            pacmanCtx = pacmanCanvas.getContext('2d');
            
            const gridSize = 25;
            pacman = { 
                x: Math.floor(pacmanCanvas.width / 2 / gridSize) * gridSize, 
                y: Math.floor(pacmanCanvas.height / 2 / gridSize) * gridSize, 
                size: gridSize - 5,
                dx: 0, 
                dy: 0,
                mouth: 0.2
            };
            
            // Create dots
            dots = [];
            const rows = Math.floor(pacmanCanvas.height / gridSize);
            const cols = Math.floor(pacmanCanvas.width / gridSize);
            for (let r = 0; r < rows; r++) {
                for (let c = 0; c < cols; c++) {
                    if (Math.random() > 0.3) {
                        dots.push({ x: c * gridSize + gridSize / 2, y: r * gridSize + gridSize / 2, eaten: false });
                    }
                }
            }
            
            // Create ghosts
            ghosts = [
                { x: 50, y: 50, color: '#ff0000', dx: 2, dy: 0 },
                { x: pacmanCanvas.width - 75, y: 50, color: '#00ffff', dx: -2, dy: 0 },
                { x: 50, y: pacmanCanvas.height - 75, color: '#ffb8ff', dx: 0, dy: 2 },
                { x: pacmanCanvas.width - 75, y: pacmanCanvas.height - 75, color: '#ffb852', dx: 0, dy: -2 }
            ];
            
            pacmanScore = 0;
            pacmanLives = 3;
            pacmanGameRunning = true;
            
            document.getElementById('pacmanScore').textContent = pacmanScore;
            document.getElementById('pacmanLives').textContent = pacmanLives;
            
            document.addEventListener('keydown', changePacmanDirection);
            pacmanGameLoop();
        }

        function changePacmanDirection(e) {
            const gridSize = 25;
            const LEFT = 37, UP = 38, RIGHT = 39, DOWN = 40;
            const A = 65, W = 87, D = 68, S = 83;
            
            if (e.keyCode === LEFT || e.keyCode === A) {
                pacman.dx = -gridSize / 5; pacman.dy = 0;
            } else if (e.keyCode === UP || e.keyCode === W) {
                pacman.dx = 0; pacman.dy = -gridSize / 5;
            } else if (e.keyCode === RIGHT || e.keyCode === D) {
                pacman.dx = gridSize / 5; pacman.dy = 0;
            } else if (e.keyCode === DOWN || e.keyCode === S) {
                pacman.dx = 0; pacman.dy = gridSize / 5;
            }
        }

        function pacmanGameLoop() {
            if (!pacmanGameRunning) return;
            
            setTimeout(() => {
                pacmanCtx.fillStyle = '#000';
                pacmanCtx.fillRect(0, 0, pacmanCanvas.width, pacmanCanvas.height);
                
                // Move and wrap pacman
                pacman.x += pacman.dx;
                pacman.y += pacman.dy;
                
                if (pacman.x < 0) pacman.x = pacmanCanvas.width;
                if (pacman.x > pacmanCanvas.width) pacman.x = 0;
                if (pacman.y < 0) pacman.y = pacmanCanvas.height;
                if (pacman.y > pacmanCanvas.height) pacman.y = 0;
                
                // Animate mouth
                pacman.mouth = (pacman.mouth + 0.1) % (Math.PI / 4);
                
                // Draw pacman
                pacmanCtx.fillStyle = '#ffff00';
                pacmanCtx.beginPath();
                const startAngle = pacman.mouth;
                const endAngle = Math.PI * 2 - pacman.mouth;
                
                if (pacman.dx > 0) pacmanCtx.arc(pacman.x, pacman.y, pacman.size / 2, startAngle, endAngle);
                else if (pacman.dx < 0) pacmanCtx.arc(pacman.x, pacman.y, pacman.size / 2, Math.PI + startAngle, Math.PI + endAngle);
                else if (pacman.dy > 0) pacmanCtx.arc(pacman.x, pacman.y, pacman.size / 2, Math.PI / 2 + startAngle, Math.PI / 2 + endAngle);
                else if (pacman.dy < 0) pacmanCtx.arc(pacman.x, pacman.y, pacman.size / 2, -Math.PI / 2 + startAngle, -Math.PI / 2 + endAngle);
                else pacmanCtx.arc(pacman.x, pacman.y, pacman.size / 2, startAngle, endAngle);
                
                pacmanCtx.lineTo(pacman.x, pacman.y);
                pacmanCtx.fill();
                
                // Draw and check dots
                let allEaten = true;
                dots.forEach(dot => {
                    if (!dot.eaten) {
                        allEaten = false;
                        pacmanCtx.fillStyle = '#fff';
                        pacmanCtx.beginPath();
                        pacmanCtx.arc(dot.x, dot.y, 3, 0, Math.PI * 2);
                        pacmanCtx.fill();
                        
                        // Check if pacman eats dot
                        const dist = Math.hypot(pacman.x - dot.x, pacman.y - dot.y);
                        if (dist < pacman.size / 2) {
                            dot.eaten = true;
                            pacmanScore += 10;
                            document.getElementById('pacmanScore').textContent = pacmanScore;
                        }
                    }
                });
                
                if (allEaten) {
                    alert(`You Win! Score: ${pacmanScore}`);
                    pacmanGameRunning = false;
                    return;
                }
                
                // Move and draw ghosts
                ghosts.forEach(ghost => {
                    ghost.x += ghost.dx;
                    ghost.y += ghost.dy;
                    
                    // Bounce ghosts off walls
                    if (ghost.x < 25 || ghost.x > pacmanCanvas.width - 25) ghost.dx = -ghost.dx;
                    if (ghost.y < 25 || ghost.y > pacmanCanvas.height - 25) ghost.dy = -ghost.dy;
                    
                    // Random direction change
                    if (Math.random() < 0.02) {
                        ghost.dx = (Math.random() - 0.5) * 4;
                        ghost.dy = (Math.random() - 0.5) * 4;
                    }
                    
                    // Draw ghost
                    pacmanCtx.fillStyle = ghost.color;
                    pacmanCtx.beginPath();
                    pacmanCtx.arc(ghost.x, ghost.y, 12, 0, Math.PI * 2);
                    pacmanCtx.fill();
                    
                    // Draw eyes
                    pacmanCtx.fillStyle = '#fff';
                    pacmanCtx.fillRect(ghost.x - 6, ghost.y - 4, 5, 5);
                    pacmanCtx.fillRect(ghost.x + 1, ghost.y - 4, 5, 5);
                    pacmanCtx.fillStyle = '#000';
                    pacmanCtx.fillRect(ghost.x - 4, ghost.y - 2, 2, 2);
                    pacmanCtx.fillRect(ghost.x + 3, ghost.y - 2, 2, 2);
                    
                    // Check collision with pacman
                    const dist = Math.hypot(pacman.x - ghost.x, pacman.y - ghost.y);
                    if (dist < (pacman.size / 2 + 12)) {
                        pacmanLives--;
                        document.getElementById('pacmanLives').textContent = pacmanLives;
                        if (pacmanLives === 0) {
                            gameOver('pacman');
                            return;
                        }
                        // Reset pacman position
                        pacman.x = pacmanCanvas.width / 2;
                        pacman.y = pacmanCanvas.height / 2;
                        pacman.dx = 0;
                        pacman.dy = 0;
                    }
                });
                
                pacmanGameLoop();
            }, 50);
        }

        function restartPacman() {
            startPacman();
        }

        // ========== GAME OVER ==========
        function gameOver(game) {
            switch(game) {
                case 'snake':
                    snakeGameRunning = false;
                    alert(`Game Over! Final Score: ${snakeScore}`);
                    break;
                case 'racing':
                    racingGameRunning = false;
                    alert(`Game Over! Distance: ${Math.floor(racingDistance)}`);
                    break;
                case 'tetris':
                    tetrisGameRunning = false;
                    alert(`Game Over! Final Score: ${tetrisScore}`);
                    break;
                case 'pacman':
                    pacmanGameRunning = false;
                    alert(`Game Over! Final Score: ${pacmanScore}`);
                    break;
            }
        }

        // Auto-add some demo friend requests on login
        setTimeout(() => {
            if (currentUsername && friendRequests.length === 0) {
                receiveFriendRequest('ProGamer123');
                receiveFriendRequest('SnakeKing');
            }
        }, 5000);
    </script>
</body>
</html>
